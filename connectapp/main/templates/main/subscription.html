{% extends 'main/layout.html' %}

{% load static %}

{% block title %}–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–µ—Ä–≤–∏—Å - Connect{% endblock %}

{% block link %}
    <link rel="stylesheet" href="{% static 'main/css/subscription.css' %}">
{% endblock %}

{% block content %}
<div class="subscription-page">
    <h1>–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ <span class="logo-gradient">Connect</span></h1>
    <p class="subtitle">–ü–æ–ª—É—á–∏—Ç–µ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ–±—â–µ–Ω–∏—é —Å AI –∏ —Å–æ–∑–¥–∞–Ω–∏—é –ø–æ—Å—Ç–æ–≤ –≤—Å–µ–≥–æ –∑–∞ <strong>299‚ÇΩ/–º–µ—Å—è—Ü</strong>!</p>

    <div class="subscription-plans">
        <div class="plan">
            <h2>–ï–¥–∏–Ω—ã–π —Ç–∞—Ä–∏—Ñ</h2>
            <p class="price">299‚ÇΩ/–º–µ—Å—è—Ü</p>
            <ul>
                <li>ü§ñ –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ —Å AI –≤ —á–∞—Ç–∞—Ö</li>
                <li>üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Å—Ç–æ–≤</li>
                <li>üöÄ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7</li>
                <li>üîí –ë–µ–∑ —Å–∫—Ä—ã—Ç—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</li>
            </ul>
            <div id="button_container"></div>
        </div>
    </div>

    <div class="marketing-highlight">
        <p>‚ú® <strong>–ü–æ—á–µ–º—É —ç—Ç–æ –≤—ã–≥–æ–¥–Ω–æ?</strong> ‚ú®</p>
        <p>–° Connect –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Å–∞–º—ã–º –ø–µ—Ä–µ–¥–æ–≤—ã–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º AI –¥–ª—è –æ–±—â–µ–Ω–∏—è –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞. –í—Å–µ–≥–æ –∑–∞ 299‚ÇΩ –≤ –º–µ—Å—è—Ü ‚Äî —ç—Ç–æ –º–µ–Ω—å—à–µ, —á–µ–º —á–∞—à–∫–∞ –∫–æ—Ñ–µ –≤ –¥–µ–Ω—å!</p>
    </div>

    <div class="subscription-info">
        <p>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ <strong>Yandex.Pay</strong>. –≠—Ç–æ –±—ã—Å—Ç—Ä–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ —É–¥–æ–±–Ω–æ!</p>
        <p>–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ <a href="https://t.me/connect_support">—Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏</a>.</p>
    </div>
</div>

<script>
    function onYaPayLoad() {
        const YaPay = window.YaPay;
    
        const paymentData = {
            env: YaPay.PaymentEnv.Sandbox,
            version: 4,
            currencyCode: YaPay.CurrencyCode.Rub,
            merchantId: '2', // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π ID
            totalAmount: '299.00',
            availablePaymentMethods: ['CARD', 'SPLIT'],
        };
    
        async function onPayButtonClick() {
            try {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                const response = await fetch('/create_order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken,
                    },
                    body: JSON.stringify({}),
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                if (data.paymentUrl) {
                    window.location.href = data.paymentUrl;
                } else {
                    throw new Error('Payment URL not found');
                }
            } catch (error) {
                console.error('Error during payment process:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–ª–∞—Ç–µ–∂–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        }
    
        function onFormOpenError(reason) {
            console.error(`–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã: ${reason}`);
            alert('–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –æ–ø–ª–∞—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.');
        }
    
        YaPay.createSession(paymentData, {
            onPayButtonClick: onPayButtonClick,
            onFormOpenError: onFormOpenError,
        })
            .then(function (paymentSession) {
                paymentSession.mountButton(document.querySelector('#button_container'), {
                    type: YaPay.ButtonType.Pay,
                    theme: YaPay.ButtonTheme.Black,
                    width: YaPay.ButtonWidth.Auto,
                });
            })
            .catch(function (err) {
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–µ—Å—Å–∏—é:', err);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–ø–ª–∞—Ç—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            });
    }
</script>
<script src="https://pay.yandex.ru/sdk/v1/pay.js" onload="onYaPayLoad()" async></script>

{% endblock %}
